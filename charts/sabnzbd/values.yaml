replicaCount: 1

image:
  repository: linuxserver/sabnzbd
  pullPolicy: Always
  tag: "latest"

container:
  env:
    tz: America/Chicago
    puid: 1000
    pgid: 1000
  additionalMounts:
    - mountPath: /tmp/sabnzbd.ini
      subPath: sabnzbd.ini
      name: sabnzbd-config-ini

initContainers:
  - name: copy
    image: bash
    command: ["bash", "-c", "if [ -f /config/sabnzbd.ini ]; then exit 0; else cp /tmp/sabnzbd.ini /config/sabnzbd.ini; fi"]
    volumeMounts:
      - mountPath: /config
        name: config
      - mountPath: /tmp/sabnzbd.ini
        subPath: sabnzbd.ini
        name: sabnzbd-config-ini

extraContainers: |
  - name: vpn
    image: {{ .Values.vpn.image.repository }}:{{ .Values.vpn.image.tag | default "latest" }}
    imagePullPolicy: {{ .Values.vpn.image.pullPolicy }}
    env:
      - name: VPN_SERVICE_PROVIDER
        value: custom
      - name: VPN_TYPE
        value: {{ quote .Values.vpn.env.type | default "wireguard" }}
      - name: VPN_ENDPOINT_IP
        value: {{ quote .Values.vpn.env.vpn_endpoint_ip }}
      - name: VPN_ENDPOINT_PORT
        value: {{ quote .Values.vpn.env.vpn_endpoint_port }}
      {{- if .Values.vpn.env.wg_existing_secret }}
      - name: WIREGUARD_PUBLIC_KEY
        valueFrom:
          secretKeyRef:
            key: WIREGUARD_PUBLIC_KEY
            name: {{ .Values.vpn.env.wg_existing_secret }}
            optional: false
      - name: WIREGUARD_PRIVATE_KEY
        valueFrom:
          secretKeyRef:
            key: WIREGUARD_PRIVATE_KEY
            name: {{ .Values.vpn.env.wg_existing_secret }}
            optional: false
      - name: WIREGUARD_PRESHARED_KEY
        valueFrom:
          secretKeyRef:
            key: WIREGUARD_PRESHARED_KEY
            name: {{ .Values.vpn.env.wg_existing_secret }}
            optional: false
      {{- else }}
      - name: WIREGUARD_PUBLIC_KEY
        value: {{ .Values.vpn.env.wg_public_key }}
      - name: WIREGUARD_PRIVATE_KEY
        value: {{ .Values.vpn.env.wg_private_key }}
      - name: WIREGUARD_PRESHARED_KEY
        value: {{ .Values.vpn.env.wg_preshared_key }}
      {{- end }}
      - name: WIREGUARD_ADDRESSES
        value: {{ quote .Values.vpn.env.wireguard_cidr }}
      - name: FIREWALL_INPUT_PORTS
        value: "8080,9090,4191,4143,4140,4190"
      - name: DOT
        value: "off"
      - name: DNS_ADDRESS
        value: {{ quote .Values.vpn.env.dns_address | default "8.8.8.8" }}
    ports:
      - containerPort: 8080
        name: sabnzbd
        protocol: TCP
    resources: {}
    securityContext:
      allowPrivilegeEscalation: true
      capabilities:
        add:
          - NET_ADMIN
          - SYS_MODULE
      privileged: true

extraVolumes: |
  - name: sabnzbd-config-ini
    configMap:
      name: {{ include "common.fullname" . }}
      defaultMode: 0777

vpn:
  image:
    repository: qmcgaw/gluetun
    pullPolicy: IfNotPresent
    tag: "latest"
  env:
    wg_existing_secret: ""
    wg_public_key: ""
    wg_private_key: ""
    wg_preshared_key: ""
    wireguard_cidr: ""
    vpn_endpoint_ip: ""
    vpn_endpoint_port: "51820"
    type: "wireguard"

persistence:
  storageClass: ""
  existingClaim: ""
  enabled: true
  accessMode: ReadWriteOnce
  size: 2Gi
  additionalVolumes: []
  additionalMounts: []

service:
  type: ClusterIP
  protocol: TCP
  port: 8080
  targetPort: 8080

ingress:
  enabled: true
  clusterIssuer: letsencrypt-prod
  class: nginx
  acme: true
  fqdn: sabnzbd.example.com

# Gateway API (disabled by default)
gateway:
  enabled: false
  gatewayClassName: ""
  name: ""
  namespace: ""
  listeners:
    - name: http
      protocol: HTTP
      port: 80
      hostname: ""
  route:
    name: ""
    namespace: ""
    hostnames: []
    matches:
      - path:
          type: PathPrefix
          value: /
    filters: []
