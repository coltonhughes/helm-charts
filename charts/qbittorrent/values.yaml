replicaCount: 1

deploymentStrategy:
  type: Recreate

image:
  repository: linuxserver/qbittorrent
  pullPolicy: Always
  tag: "latest"

container:
  env:
    TZ: America/Chicago
    PUID: "1000"
    PGID: "1000"
    WEBUI_PORT: "8080"
    TORRENT_PORT: "50000"

vpn:
  image:
    repository: qmcgaw/gluetun
    pullPolicy: IfNotPresent
    tag: "5.0.4"
  env:
    wg_existing_secret: ""
    wg_public_key: ""
    wg_private_key: ""
    wg_preshared_key: ""
    wireguard_cidr: ""
    vpn_endpoint_ip: ""
    vpn_endpoint_port: "51820"
    type: "wireguard"
    dns_address: "8.8.8.8"

extraContainersTemplate: |
  - name: vpn
    image: "{{ .Values.vpn.image.repository }}:{{ .Values.vpn.image.tag | default "latest" }}"
    imagePullPolicy: "{{ .Values.vpn.image.pullPolicy }}"
    env:
      - name: VPN_SERVICE_PROVIDER
        value: custom
      - name: VPN_TYPE
        value: "{{ .Values.vpn.env.type | default "wireguard" }}"
      - name: WIREGUARD_ENDPOINT_IP
        value: "{{ .Values.vpn.env.vpn_endpoint_ip }}"
      - name: WIREGUARD_ENDPOINT_PORT
        value: "{{ .Values.vpn.env.vpn_endpoint_port }}"
      {{ if .Values.vpn.env.wg_existing_secret }}
      - name: WIREGUARD_PUBLIC_KEY
        valueFrom:
          secretKeyRef:
            key: WIREGUARD_PUBLIC_KEY
            name: "{{ .Values.vpn.env.wg_existing_secret }}"
            optional: false
      - name: WIREGUARD_PRIVATE_KEY
        valueFrom:
          secretKeyRef:
            key: WIREGUARD_PRIVATE_KEY
            name: "{{ .Values.vpn.env.wg_existing_secret }}"
            optional: false
      - name: WIREGUARD_PRESHARED_KEY
        valueFrom:
          secretKeyRef:
            key: WIREGUARD_PRESHARED_KEY
            name: "{{ .Values.vpn.env.wg_existing_secret }}"
            optional: false
      {{ else }}
      - name: WIREGUARD_PUBLIC_KEY
        value: "{{ .Values.vpn.env.wg_public_key }}"
      - name: WIREGUARD_PRIVATE_KEY
        value: "{{ .Values.vpn.env.wg_private_key }}"
      - name: WIREGUARD_PRESHARED_KEY
        value: "{{ .Values.vpn.env.wg_preshared_key }}"
      {{ end }}
      - name: WIREGUARD_ADDRESSES
        value: "{{ .Values.vpn.env.wireguard_cidr }}"
      - name: FIREWALL_INPUT_PORTS
        value: "8080,50000"
      - name: FIREWALL_VPN_INPUT_PORTS
        value: "50000"
      - name: DOT
        value: "off"
      - name: DNS_ADDRESS
        value: "{{ .Values.vpn.env.dns_address }}"
    ports:
      - containerPort: 8080
        name: vpn
        protocol: TCP
      - containerPort: 50000
        name: torrent
        protocol: TCP
    resources: {}
    securityContext:
      allowPrivilegeEscalation: true
      capabilities:
        add:
          - NET_ADMIN
          - SYS_MODULE
      privileged: true

containerPorts:
  - name: ui
    containerPort: 8080
    protocol: TCP
  - name: torrent
    containerPort: 50000
    protocol: TCP

persistence:
  storageClass: ""
  existingClaim: ""
  enabled: true
  accessMode: ReadWriteOnce
  size: 2Gi
  mountPath: /config
  name: qbittorrent-config

service:
  type: LoadBalancer
  port: 8080
  ports:
    - name: ui
      protocol: TCP
      port: 8080
      targetPort: ui
    - name: torrent
      protocol: TCP
      port: 50000
      targetPort: torrent

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: "true"
  hosts:
    - host: qbittorrent.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: qbittorrent-tls
      hosts:
        - qbittorrent.example.com

volumes: []
volumeMounts: []
